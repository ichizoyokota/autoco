<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script
            src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script>
</head>
<body>

<div>
    <p>弁護士検索API</p>
<form action="/api/top" method="post">
    <label for='lowerid'>弁護士番号</label>
    <input type='text' name='lowerid' id='lowerid' placeholder='0123456'>

</form>
<button id='sendBtn'>APIに問い合わせる</button>

<div id='response'></div>
</div>

<hr>

<div>
    <p>銀行情報検索API</p>
    <form>
        <input type="text" id="bank_code" placeholder="0001" max="9999" maxlength="4" min="0" autofocus>
        <input type="text" id="bank_name" placeholder="みずほ" disabled>
        <input type="text" id="branch_code" placeholder="001" maxlength="3" min="0" max="999">
        <input type="text" id="branch_name" placeholder="東京営業部" disabled>
    </form>

</div>


<h2 id="a3">テスト（サンドボックス）用クレジットカード</h2>

<table>
    <thead>
    <tr>
        <th>項目</th>
        <th>値</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>クレジットカード番号</td>
        <td>4444-3333-2222-1111</td>
    </tr>
    <tr>
        <td>有効期限</td>
        <td>現在より未来の任意の年月を指定してください。</td>
    </tr>
    <tr>
        <td>CVC</td>
        <td>任意の3桁か4桁の値を入力してください。</td>
    </tr>
    </tbody>
</table>

<button id="customButton">カスタム</button>


<script src="https://checkout.spike.cc/v1/checkout.js"></script>
<script>

    // SPIKE Checkoutのインスタンスを生成する
    var handler = SpikeCheckout.configure({
        key: "pk_test_uAvQJvNxZ7d6Am5L4thJn4nG",
        token: function(token) {
            $('<input>')
                .attr('type', 'hidden')
                .attr('name', 'card_token')
                .val(token.id)
                .appendTo('form');
            $('form').submit();
        },
        opened: function(e) {

            console.log('opened')
            console.log(e)
            // Window opened event
        },
        closed: function(e) {
            console.log('closed')
            console.log(e)
            // Window closed event
        }
    });


    // カード情報を入力するオーバーレイを開く処理
    document.getElementById("customButton").addEventListener("click", function(e) {
        handler.open({
            name: "オンラインショップ",
            currency: "JPY",
            email: "foo@example.com",
        });
        e.preventDefault();
    });
</script>
</body>
</html>


<script type="text/javascript">

    document.getElementById('sendBtn').addEventListener('click', postApi)
    function postApi(event) {
        let lowerid = document.getElementById('lowerid').value
        $.ajax({
            type: 'POST',
            url: '/api/top',
            data: {lowerid: lowerid}
        }).done(function (data) {
           $('#response').empty()
           $('#response').append(JSON.stringify(data))
        });
    }


    document.getElementById("customButton").addEventListener("click", function(e) {
        handler.open({
            name: "オンラインショップ",
            currency: "JPY",
            guest: true,
            email: "yokota@yeees.in",
        });
        e.preventDefault();
    });


    //これはAPI提供者のサンプル・・・。作り直し。
    $(function(){
        // handling bank code
        $('#bank_code').keyup(function(e){

            if (!((48 <= e.keyCode && e.keyCode <= 57) || e.keyCode == 91 || e.keyCode == 17)) { // 0 - 9, cmd, ctrl
                return;
            }

            $('#bank_name').val('').attr('placeholder', ''); // empty

            bank_code = $('#bank_code').val();

            if (bank_code.length != 4) {
                return;
            }

            $.getJSON("https://bank.teraren.com/banks/" + bank_code + ".json", function(json){
                $('#bank_name').val(json.name);
            }).error(function(jqXHR, textStatus, errorThrown) {
                $('#bank_name').val('');
            });

        });


        // handling bank branch code
        $('#branch_code').keyup(function(e){

            if (!(48 <= e.keyCode && e.keyCode <= 57)) { // 0 - 9
                return;
            }

            $('#branch_name').val('').attr('placeholder', ''); // empty

            bank_code = $('#bank_code').val();
            bank_branch = $('#branch_code').val();

            if (bank_code.length != 4) {
                return;
            }

            if (bank_branch.length != 3) {
                return;
            }

            $.getJSON("http://bank.teraren.com/banks/" + bank_code + "/branches/"+bank_branch+".json", function(json){
                $('#branch_name').val(json.name);
            }).error(function(jqXHR, textStatus, errorThrown) {
                $('#branch_name').val('').attr('placeholder', ''); // empty
            });

        });
    });

</script>